name: CI - Tienda Zara

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Backend â€“ Symfony 7 / PHP 8.2
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  backend:
    name: ğŸ˜ Backend (Symfony)
    runs-on: ubuntu-latest

    env:
      APP_ENV: test
      APP_DEBUG: 0
      APP_SECRET: ci-dummy-secret-value-1234567890
      DATABASE_URL: "sqlite:///%kernel.project_dir%/var/data_test.db"
      CORS_ALLOW_ORIGIN: "^https?://localhost(:[0-9]+)?$"
      DEFAULT_URI: "http://localhost"
      STRIPE_SECRET_KEY: "sk_test_dummy_value_for_ci_only"

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ˜ Configurar PHP 8.2
        uses: shivammathur/setup-php@v2
        with:
          php-version: "8.2"
          extensions: intl, pdo_sqlite, mbstring, xml, ctype, iconv, bcmath, zip
          coverage: none

      - name: ğŸ“¦ Cache de Composer
        uses: actions/cache@v4
        with:
          path: vendor
          key: composer-${{ hashFiles('composer.lock') }}
          restore-keys: composer-

      - name: ğŸ“¦ Instalar dependencias Composer
        run: composer install --no-interaction --prefer-dist --optimize-autoloader

      - name: âœ… Lint del contenedor de servicios
        run: php bin/console lint:container

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Frontend â€“ React 18 / Vite
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  frontend:
    name: âš›ï¸ Frontend (React)
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: frontend

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Configurar Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
          cache-dependency-path: frontend/package-lock.json

      - name: ğŸ“¦ Instalar dependencias npm
        run: npm ci

      - name: ğŸ—ï¸ Build de producciÃ³n
        run: npm run build
